name: Demo App
description: A simple demo app for testing Fileglancer job submission. Sleeps and prints messages.
version: "1.0"

requirements:
  - "pixi>=0.40"
  - apptainer

runnables:
  - id: run
    name: Run Demo
    description: Sleep for a specified duration and print a message repeatedly.
    command: pixi run python demo.py
    parameters:
      - flag: --message
        name: Message
        type: string
        description: The message to print
        required: true
        default: "Hello from Fileglancer!"

      - flag: --repeat
        name: Repeat Count
        type: integer
        description: Number of times to repeat the message
        required: false
        default: 3
        min: 1
        max: 100

      - flag: --output_dir
        name: Output Directory
        type: directory
        description: Directory to write a summary output file (optional)
        required: false

      - section: Advanced Options
        description: Optional tuning parameters
        collapsed: true
        parameters:
          - flag: --sleep_seconds
            name: Sleep Duration
            type: integer
            description: Number of seconds to sleep between messages
            required: false
            default: 5
            min: 0
            max: 300

          - flag: --verbose
            name: Verbose
            type: boolean
            description: Enable verbose output with sleep countdown
            required: false
            default: false

    resources:
      cpus: 1
      memory: "1 GB"
      walltime: "00:10"

  - id: serve
    name: Demo Service
    type: service
    description: Start a simple HTTP server that displays a status page. Runs until stopped.
    command: pixi run python demo_service.py
    parameters:
      - flag: --message
        name: Message
        type: string
        description: Message to display on the status page
        required: false
        default: "Hello from Fileglancer!"

      - flag: --port
        name: Port
        type: integer
        description: Port to listen on (0 = auto-detect a free port)
        required: false
        default: 0
        min: 0
        max: 65535

    resources:
      cpus: 1
      memory: "1 GB"
      walltime: "08:00"

  - id: lolcow
    name: Demo Container
    description: Print a message with a talking cow using the classic lolcow Apptainer container.
    command: cowsay
    container: godlovedc/lolcow
    parameters:
      - name: Message
        type: string
        description: What the cow should say
        required: true
        default: "Hello from Fileglancer!"

    resources:
      cpus: 1
      memory: "1 GB"
      walltime: "00:05"
